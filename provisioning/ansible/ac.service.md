## Colabo.space service

- Project > Compute > Istances > Launch Instance
  - Details
    - Instance Name: `ac-service-1`
    - Availability Zone: `osl-default-1`
  - Source
    - Select Boot Source: Image
    - Allocated: `GOLD Ubuntu 18.04 LTS`
  - Flavor: `m1.large`
  - Networks: `dualStack`
  - Security Groups
    - add group `ICMP-SSH-HTTP-security-group`
  - Key Pair
    - add your key pair (if it is the only one it will be injected already)
    - you cannot add more than one at this stage
  - **`Launch Instance`**

Test if the *orchestration* machine is alive: `ping <F_IP>`

Try to login to your newly started machine:

- `ssh -i ~/.ssh/<key-name> ubuntu@<F_IP>`
- NOTE: you will not need pass since you use private key instead
- to do something difficult use `sudo command` :), ubuntu is a default user and it is sudoer


## Initial install

```sh
sudo apt-get install joe
```

## Add user related

```sh
sudo groupadd developers
sudo usermod -a -G developers ubuntu
```

## Add Orchestrator user

```sh
sudo useradd -m -d /home/orchestrator  -c "Orchestrator User" -s /bin/bash orchestrator
sudo usermod --lock orchestrator
sudo usermod -a -G developers orchestrator
sudo usermod -a -G sudo orchestrator
sudo mkdir /home/orchestrator/.ssh
sudo chown -R orchestrator:orchestrator /home/orchestrator/.ssh
sudo chmod 700 /home/orchestrator/.ssh
sudo touch /home/orchestrator/.ssh/authorized_keys
sudo chown -R orchestrator:orchestrator /home/orchestrator/.ssh/authorized_keys
sudo chmod 600 /home/orchestrator/.ssh/authorized_keys

sudo joe /home/orchestrator/.ssh/authorized_keys
# write inside <START>
# orchestrator autogenerated by OpenStack DashBoard, added to disk image
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTIJQoJvPt69Mu7TAVSwUqTZqkafu4+3cVcZnJiyeclZiuK3LZNmPHsqM8DhpERSYkMvi3UAQ8FqnCj4+OnBNhyQnc6BXlogmiFHTJ6Az+GraXaSPABxnUYummnMsAWCnHavp7+mQ76dXcj3N/tpJMuAHykTVFp1RvMjoIJQKHj4+u34PJx0mVDYnCmXEJi4Z+GNYyv7CISua1HLTJWgoMMgboHWnj4RMREVNxoyiQNnvdANxl3yQLvKkcdMtlbduuETVxH/otDqHTqgXqrlswIj3dm4Xmdf+/iWTDL1StbFt3HC3GztIRAEtDOdb1HSls8M2B3iWh62Tio16+MzM9 Generated-by-Nova
# </END>

sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>

# User rules for orchestrator
orchestrator ALL=(ALL) NOPASSWD:ALL

# </END>
```

Log out and login as orchestrator user

__UP TO HERE__

## Installing

```sh
sudo apt-get update
sudo apt-get install joe
sudo apt-get install screen
sudo apt-get install unzip
sudo apt-get install git
sudo apt-get install cowsay
sudo apt-get install fortune
sudo apt-get install gcc
sudo apt-get install mongodb-clients
```

### Profile

```sh
joe ~/.bashrc
# add: <start>
fortune | cowsay -f tux
# </start>
source ~/.bashrc
```

### Accounts

```sh
sudo groupadd developers
sudo usermod -a -G developers ubuntu
# enable private key authenticated users (so no pass) to run sudo without passes
sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>:
# Created by colabo.space-team
# </END>
```

### Web Folders

```sh
sudo mkdir -p /var/www
sudo chown www-data /var/www
sudo chgrp developers /var/www
sudo chmod g+rwxs /var/www
```

```sh
sudo mkdir /var/colabo
sudo chown www-data /var/colabo
sudo chgrp -R developers /var/colabo
sudo chmod g+rwxs /var/colabo
```

### Creating users

+ [Add a user wthout password but with SSH and public key](https://unix.stackexchange.com/questions/210228/add-a-user-wthout-password-but-with-ssh-and-public-key)
+ https://askubuntu.com/questions/743852/how-to-create-new-user-with-public-key-authentication
+ http://manpages.ubuntu.com/manpages/xenial/en/man8/sshd.8.html
+ sudo without pass
  + [sudo without password when logged in with SSH private keys](https://superuser.com/questions/492405/sudo-without-password-when-logged-in-with-ssh-private-keys)
  + [SSH key auth, but still need password for sudo?](https://security.stackexchange.com/questions/72689/ssh-key-auth-but-still-need-password-for-sudo)

ansimble

```sh
sudo useradd -m -d /home/ansible  -c "Ansible User" -s /bin/bash ansible
sudo usermod --lock ansible
sudo usermod -a -G developers ansible
sudo usermod -a -G sudo ansible
sudo mkdir /home/ansible/.ssh
sudo chown -R ansible:ansible /home/ansible/.ssh
sudo chmod 700 /home/ansible/.ssh
sudo touch /home/ansible/.ssh/authorized_keys
sudo chown -R ansible:ansible /home/ansible/.ssh/authorized_keys
sudo chmod 600 /home/ansible/.ssh/authorized_keys

sudo joe /home/ansible/.ssh/authorized_keys
# write inside <START>
# ansible autogenerated by OpenStack DashBoard, added to disk image
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTIJQoJvPt69Mu7TAVSwUqTZqkafu4+3cVcZnJiyeclZiuK3LZNmPHsqM8DhpERSYkMvi3UAQ8FqnCj4+OnBNhyQnc6BXlogmiFHTJ6Az+GraXaSPABxnUYummnMsAWCnHavp7+mQ76dXcj3N/tpJMuAHykTVFp1RvMjoIJQKHj4+u34PJx0mVDYnCmXEJi4Z+GNYyv7CISua1HLTJWgoMMgboHWnj4RMREVNxoyiQNnvdANxl3yQLvKkcdMtlbduuETVxH/otDqHTqgXqrlswIj3dm4Xmdf+/iWTDL1StbFt3HC3GztIRAEtDOdb1HSls8M2B3iWh62Tio16+MzM9 Generated-by-Nova
# </END>

sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>

# User rules for ansible
ansible ALL=(ALL) NOPASSWD:ALL

# </END>
```

Sasha (mPrinC)

```sh
sudo useradd -m -d /home/mprinc  -c "Sasha Rudan" -s /bin/bash mprinc
sudo usermod --lock mprinc
sudo usermod -a -G developers mprinc
sudo usermod -a -G sudo mprinc
sudo mkdir /home/mprinc/.ssh
sudo chown -R mprinc:mprinc /home/mprinc/.ssh
sudo chmod 700 /home/mprinc/.ssh
sudo touch /home/mprinc/.ssh/authorized_keys
sudo chown -R mprinc:mprinc /home/mprinc/.ssh/authorized_keys
sudo chmod 600 /home/mprinc/.ssh/authorized_keys

sudo joe /home/mprinc/.ssh/authorized_keys
# write inside <START>
# mprinc/sasha autogenerated by OpenStack DashBoard, added to disk image
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDCMJiG4ngrr4riYbK7hPvtmc/glrRtzUsEE5rAvCznjwGkBLhtfBMwWHiA/hG5gED9sUhQp5PZj8BttkyebHRQC19DwNRLyTPEF4PiqNiyN/01HKFVYdc1F4BjnHIjK4rjgk/NQ2kuc0oEyt/LDzPZnLGQnqO2AAWl7oh2Wl+0L9hr+rNOroBBO/5HI+2V80Qm3QkUQdq56ujl40GmI3QIs0Pk8bJUfhs8kiT1ECdTdHzgHblSI1erO2vE4WAOo9BRl+W1wcHDVU09VGpn81ag6qOJatbwFo4JGyS9ZY5vfTshtWtg+8eUyewNII+6dAl0UY0EpDSJhlquNFr79OG/ Generated-by-Nova
# </END>

sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>

# User rules for mprinc
mprinc ALL=(ALL) NOPASSWD:ALL

# </END>
```

mirko

```sh
sudo useradd -m -d /home/mirko  -c "Mirko Kovacevic" -s /bin/bash mirko
sudo usermod --lock mirko
sudo usermod -a -G developers mirko
sudo usermod -a -G sudo mirko
sudo mkdir /home/mirko/.ssh
sudo chown -R mirko:mirko /home/mirko/.ssh
sudo chmod 700 /home/mirko/.ssh
sudo touch /home/mirko/.ssh/authorized_keys
sudo chown -R mirko:mirko /home/mirko/.ssh/authorized_keys
sudo chmod 600 /home/mirko/.ssh/authorized_keys

sudo joe /home/mirko/.ssh/authorized_keys
# write inside <START>
# mirko autogenerated by OpenStack DashBoard, added to disk image
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDH25q/fAbgu3ILOcJFICgvxQewyRFn1PVuTWr+pbb/oCSS/jesntlkxEcmBuIINR+llvCKDw2eGGR8ej00Q9W+CVMpNsjKo/Fu9FKyGDyyHzzW+SkOMp40SZHF535AL9rtmUIrotU8aDjDZuhxUpjnuighGIADC9XRANCwGfEB0U69ahhDOLYpYBgLxGuB+J7mwC3hYNBvyTA8lBwghGye7K4y22UdyxBE+azHCBkev/37xgb5yrBGUMCp6+2fej840qfEih1XevANBOjZV8vlfrIP0jpRqi6XSmF20h1OHy0je6cV3vBba0VWcBMpogG0//iwsANijwnruMV+QR0H Generated-by-Nova
# </END>

sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>

# User rules for mirko
mirko ALL=(ALL) NOPASSWD:ALL

# </END>
```

Sinisha (sir)

```sh
sudo useradd -m -d /home/sir  -c "Sinisha Rudan" -s /bin/bash sir
sudo usermod --lock sir
sudo usermod -a -G developers sir
sudo usermod -a -G sudo sir
sudo mkdir /home/sir/.ssh
sudo chown -R sir:sir /home/sir/.ssh
sudo chmod 700 /home/sir/.ssh
sudo touch /home/sir/.ssh/authorized_keys
sudo chown -R sir:sir /home/sir/.ssh/authorized_keys
sudo chmod 600 /home/sir/.ssh/authorized_keys

sudo joe /home/sir/.ssh/authorized_keys
# write inside <START>
# sir/sinisha autogenerated by OpenStack DashBoard, added to disk image
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/Rht/N+63SsrT5h3f5ml7YKyU+Zke+QMvdSlEJjI8+fqNqu50WHDXvFSMjKVcGyk8rBT9WorZPOVBeTI/smN2UIxh2w2W7pUtTDSF1LJ5mjXVisAm3A5cSfwweh/X6aNqK6oUs0m8iQ8FtImEeGkalxBFSVMdT7DV3c94dq5i5t88CdlFccnW3LaRF46WPHkRZy938cb1MDzHUtfG+WC/YkE3prPWZzolFo7HTQxXNsckzcvPFZKnwZAImEXBMVbIYXea5B5mrXLZhLK0y3hp9hd179bqNEl3FAoBL3Bfn175cWUq5SuWAbzAf4lf//h9xOx6EvLJVPEHtpYnKHnp Generated-by-Nova
# </END>

sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>

# User rules for sir
sir ALL=(ALL) NOPASSWD:ALL

# </END>
```

Lazar (laza)

```sh
sudo useradd -m -d /home/laza  -c "Lazar Kovacevic" -s /bin/bash laza
sudo usermod --lock laza
sudo usermod -a -G developers laza
sudo usermod -a -G sudo laza
sudo mkdir /home/laza/.ssh
sudo chown -R laza:laza /home/laza/.ssh
sudo chmod 700 /home/laza/.ssh
sudo touch /home/laza/.ssh/authorized_keys
sudo chown -R laza:laza /home/laza/.ssh/authorized_keys
sudo chmod 600 /home/laza/.ssh/authorized_keys

sudo joe /home/laza/.ssh/authorized_keys
# write inside <START>
# laza/lazar autogenerated by OpenStack DashBoard, added to disk image
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDYHL41qcYBDfpgW8+KmkE0KlGhNesB2DLHIJWo5vz63PpcmD3PKi2bMG1GB7/ahgi2QMOLDFrahGHq7bxPpzvzFSW7g7T0PBRg8enLZonjRwEvOEIzfG+fTuaAg5Zhd0gv3zKfaRpSSTLtZPDR25pOgb0HLCW9xgIoeUQithMVpSNraL/YW9lTNXe/mJl6LBrN29FE/9HGnEgfS7DHxTCcHqeKFlNVKxU3SuQfIoSYn6e01uqjUmHq4zDpLIEXCL2Pqdie5P19U5l/mFFuWDRhoFZdemRgvW+xQhYpqHQ46AzLjOsLZtwMm5BiEVJRg5uZvA1F3AOx1JqdUF9M9KqL Generated-by-Nova
# </END>

sudo joe /etc/sudoers.d/95-no-pass-users
# write inside <START>

# User rules for laza
laza ALL=(ALL) NOPASSWD:ALL

# </END>
```

Logout (from ubuntu account)
Login as yourself (like mprinc)

### Python related

```sh
sudo apt-get install python-pip
python -m pip install --upgrade pip
sudo -H python -m pip install virtualenv
cd /var/colabo
# create
virtualenv colabo-env
# sudo -H virtualenv colabo-env

source /var/colabo/colabo-env/bin/activate
python -m pip install grpcio
python -m pip install grpcio-tools
python -m pip install flask
python -m pip install pika
deactivate
```

```sh
cd /var/colabo
source /var/colabo/colabo-env/bin/activate
# work ...
deactivate
```

## Node.js

[Ghost Supported Node Versions](https://docs.ghost.org/docs/supported-node-versions)

```
Message: The version of Node.js you are using is not supported.
Supported: ^4.5.0 || ^6.9.0 || ^8.9.0
Installed: 9.5.0
```

So we will install node v8.9.0

[Installing Node.js via package manager](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)

+ [Install Node.js - Ubuntu](https://ru.godaddy.com/help/install-nodejs-ubuntu-17395)
+ [How To Install Node.js on Ubuntu 16.04](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-16-04)

**<u>NOTE</u>**: There are different procedures for different major versions

To get the most recent version of Node.js is to add a PPA (**P**ersonal **P**ackage **A**rchive), which is maintained by [NodeSource](https://nodesource.com/).

```sh
# not the 9.x version
# sudo curl -sL https://deb.nodesource.com/setup_9.x | sudo -E bash -
# but the 8.x one
sudo curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
sudo apt-get install -y nodejs
# Optional: install build tools
# To compile and install native addons from npm you may also need to install build tools:
# should be similar to: `sudo apt-get install gcc g++ make`
sudo apt-get install -y build-essential

## To install the Yarn package manager, run
curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update && sudo apt-get install yarn
```

Install **`@angular/cli`**:

```sh
sudo npm install -g @angular/cli
```

### Upgrade

+ [How can I update my nodeJS to the latest version?](https://askubuntu.com/questions/426750/how-can-i-update-my-nodejs-to-the-latest-version)
+ [updating nodejs on ubuntu 16.04](https://stackoverflow.com/questions/41195952/updating-nodejs-on-ubuntu-16-04)
+ https://www.npmjs.com/package/n

We will use **`n`** module from `npm` in order to upgrade node:

```sh
sudo npm cache clean -f
sudo npm install -g n
# installing particular version (6.11.4)
sudo n 6.11.4
# installed as node, not nodejs, under /usr/local/bin/node, not /usr/bin/nodejs
# it is possible to install it in a speciffic folder
```



### Yarn

https://yarnpkg.com/lang/en/docs/install/#debian-stable

```sh
# Note: Ubuntu 17.04 comes with cmdtest installed by default. If you’re getting errors from installing yarn, you may want to run sudo apt remove cmdtest first. Refer to this (https://github.com/yarnpkg/yarn/issues/2821) for more information.
sudo apt remove cmdtest

# configure the repository
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update

# install (without node)
sudo apt-get install --no-install-recommends yarn

# test
yarn --version
```
# System

## Memory

```sh
free -m
grep MemTotal /proc/meminfo
top
vmstat
vmstat -s
htop
```